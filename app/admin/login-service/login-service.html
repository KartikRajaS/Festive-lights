<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="login-service">
  <template>
   <iron-ajax
        auto
        id="addressajax"
        url="../../configfile/address.json"
        handle-as="json"
        content-type="application/json"
        on-response="addressResponse"
        debounce-duration="300"
        >
  </iron-ajax>

  <!--pass the user name and password for signin-->
  <iron-ajax
        method="get"
        id="loginajax"
        url="{{loginurl}}"
        params="{{loginparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="loginResponse"
        debounce-duration="300"
        >
  </iron-ajax>

  <!-- get the sequence number for id generation -->
  <iron-ajax
        method="post"
        id="addseqajax"
        url="{{addsequrl}}"
        handle-as="json"
        content-type="application/json"
        on-response="addseqResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  </template>

  <script>
  (function() {
        var dashpage;
    Polymer({
      is: "login-service",
      addressResponse:function(e){
        var addr=e.detail.response.address;
        sessionStorage.setItem("addrinfo",addr);
      },
     //fetch the username and password from logincard and pass to the loginajax
      logincheck:function(uname,pass)
      {
        username=uname;
        this.loginurl=sessionStorage.getItem("addrinfo")+"/login-card";
        var obj={"username":"","password":""}
        obj.username=uname;
        obj.password=pass;
        this.loginparam=obj;
        //alert(JSON.stringify(obj));
        this.$.loginajax.generateRequest();
      },

     //loginResponse from the loginajax
      loginResponse:function(e)
      {
          if((e.detail.response.returnval)!=0){
        var role=e.detail.response.returnval[0].user_name;
        document.querySelector('admin-app').setPage("dashboard","Dashboard");
      }
      else{
        alert("Please Check the Username and Password");
      }

      },
      getIDsequence:function(fnadd){
        dashpage=fnadd;
        this.addsequrl=sessionStorage.getItem("addrinfo")+"/getIDsequence";
       
        alert(dashpage);
        this.$.addseqajax.generateRequest();
      },
      addseqResponse:function(e){
        var newid;

        if(dashpage=='supplier'){
            var idno=e.detail.response.returnval[0].master_supplierid;
            newid="SU"+idno;
            document.querySelector('admin-app').setPage("suppliercard","New Supplier Details");
            document.querySelector('supplier-card').newid=newid;
        }else if(dashpage=='item'){
            var idno=e.detail.response.returnval[0].master_itemid;
            newid="IT"+idno;
            document.querySelector('admin-app').setPage("itemcard","New Item Details");
            document.querySelector('items-card').newid=newid;
        }else if(dashpage=='category'){
            var idno=e.detail.response.returnval[0].master_category;
            newid="CA"+idno;
            document.querySelector('admin-app').setPage("categorycard","New Category");
            document.querySelector('category-card').newid=newid;
        }else if(dashpage=='user'){
            var idno=e.detail.response.returnval[0].master_userid;
            newid="US"+idno;
            document.querySelector('admin-app').setPage("usercard","New User Details");
            document.querySelector('user-card').newid=newid;
        }else if(dashpage=='staff'){
            var idno=e.detail.response.returnval[0].master_staffid;
            newid="ST"+idno;
            document.querySelector('admin-app').setPage("staffcard","New Staff Details");
            document.querySelector('staff-card').newid=newid;
        }
        alert(newid);
      }

       });
})();
  </script>

</dom-module>
